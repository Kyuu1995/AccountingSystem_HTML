<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記帳系統。會員資料</title>
    <link href="font/css/fonts.css" rel="stylesheet" type="text/css">
    <link href="font/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet">
</head>

<body onload="getVariable(), showData()">
    <header>
        <div class="header">
            <a href="javascript:;" onclick="doHome()">
                <img src="./images/logo.svg" alt="logo">
                <div class="title">k<span class="span-1">e</span><span class="span-2">e</span>p a<span
                        class="span-1">cc</span>ount<span class="span-2">s</span></div>
            </a>
        </div>
    </header>
    <section>
        <form class="index-form">
            <div class="index-title" name="title" id="title">會員資料</div>
            <div class="index-input">
                <p>
                    <label for="username">Username</label>
                    <input type="text" name="username" id="username" disabled>
                </p>
                <p>
                    <label for="password">Password</label>
                    <input type="password" name="password" id="password" disabled>
                </p>
                <p>
                    <label for="Nickname">Nickname</label>
                    <input type="text" name="Nickname" id="Nickname" disabled>
                </p>
                <p>
                    <label for="email">E-mail</label>
                    <input type="email" name="email" id="email" disabled>
                </p>
                <p>
                    <label for="gender">Gender</label>
                    <select name="gender" id="gender" disabled>
                        <option value="0">請選擇項目</option>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </p>
            </div>
            <div class="index-button">
                <input type="button" name="modifyBtn" id="modifyBtn" value="修改" onclick="modify()">
                <a href="./index.html"><input type="button" name="signOutBtn" id="signOutBtn" value="登出"></a>
                <input type="button" name="defineBtn" id="defineBtn" value="確定" onclick="define()"
                    style="display: none">
                <input type="button" name="cancelBtn" id="cancelBtn" value="取消" onclick="cancel()"
                    style="display: none">
            </div>
        </form>
        <form class="variable" name="variable" id="variable">
            <input type="text" name="nickname" id="nickname">
            <input type="text" name="user" id="user">
        </form>
    </section>
    <footer>
        <div class="footer">
            <div class="footer-1">
                <div class="footer-title">use web</div>
                <div class="footer-a">
                    <a href="https://fontawesome.com/" target="_new">
                        <img src="./images/logo_FontAwesome_.png">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://www.iconfinder.com/editor/" target="_new">
                        <img src="./images/logo_Iconfinder.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://www.svgrepo.com/" target="_new">
                        <img src="./images/logo_SVGRepo.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://www.cufonfonts.com/" target="_new">
                        <img src="./images/logo_CufonFonts.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://pixlr.com/tw/" target="_new">
                        <img src="./images/logo_Pixlr.svg">
                    </a>
                </div>
            </div>
            <div class="footer-2">
                <div class="footer-title">use language</div>
                <div class="footer-a">
                    <a href="https://en.wikipedia.org/wiki/HTML" target="_new">
                        <img src="./images/logo_HTML.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://en.wikipedia.org/wiki/CSS" target="_new">
                        <img src="./images/logo_CSS.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://en.wikipedia.org/wiki/JavaScript" target="_new">
                        <img src="./images/logo_JavaScript.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://jquery.com/" target="_new">
                        <img src="./images/logo_jQuery.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://www.mysql.com/" target="_new">
                        <img src="./images/logo_MySQL.svg">
                    </a>
                </div>
                <div class="footer-a">
                    <a href="https://www.oracle.com/java/" target="_new">
                        <img src="./images/logo_Java.svg">
                    </a>
                </div>
            </div>
        </div>
    </footer>
</body>

<script src="js/jquery-3.6.0.min.js"></script>
<script>
    var variable = document.getElementById("variable")
    var nickname
    var user
    var title = document.getElementById("title")
    var username = document.getElementById("username")
    var password = document.getElementById("password")
    var Nickname = document.getElementById("Nickname")
    var email = document.getElementById("email")
    var gender = document.getElementById("gender")
    var modifyBtn = document.getElementById("modifyBtn")
    var signOutBtn = document.getElementById("signOutBtn")
    var defineBtn = document.getElementById("defineBtn")
    var cancelBtn = document.getElementById("cancelBtn")

    function getVariable() {
        if (location.href.indexOf('?') != -1) {
            var ary = location.href.split('?')[1].split('&')
            for (var i = 0; i <= ary.length - 1; i++) {
                if (ary[i].split('=')[0] == 'nickname') {
                    nickname = ary[i].split('=')[1]
                    document.getElementById("nickname").value = nickname
                } else if (ary[i].split('=')[0] == 'user') {
                    user = ary[i].split('=')[1]
                    document.getElementById("user").value = user
                }
            }
        }
    }
    function doHome() {
        variable.method = "get"
        variable.action = "./home.html"
        variable.submit()
    }
    function checkPassword() {
        var thisPassword
        $.ajax({
            async: false,
            url: "http://localhost:8080/AccountingSystem/doCheckPassword",
            type: "post",
            traditional: true,
            dataType: "json",
            data: {
                user: user
            },
            success: function (response) {
                thisPassword = response.password
            }
        })
        if (prompt("請輸入密碼︰") == thisPassword) {
            return true
        } else {
            return false
        }
    }
    function showData() {
        $.ajax({
            async: false,
            url: "http://localhost:8080/AccountingSystem/doShowProfile",
            type: "post",
            traditional: true,
            dataType: "json",
            data: {
                user: user
            },
            success: function (response) {
                username.value = response.username
                password.value = response.password
                Nickname.value = response.nickname
                email.value = response.email
                gender.value = response.gender
            }
        })
    }
    function modify() {
        if (checkPassword()) {
            title.innerHTML = "修改資料"
            password.disabled = ""
            Nickname.disabled = ""
            email.disabled = ""
            gender.disabled = ""
            modifyBtn.style.display = "none"
            signOutBtn.style.display = "none"
            defineBtn.style.display = ""
            cancelBtn.style.display = ""
        } else {
            alert("密碼輸入錯誤....")
        }
    }
    function define() {
        $.ajax({
            async: false,
            url: "http://localhost:8080/AccountingSystem/doUpdateProfile",
            type: "post",
            traditional: true,
            dataType: "json",
            data: {
                user: user,
                password: $("#password").val(),
                nickname: $("#Nickname").val(),
                email: $("#email").val(),
                gender: $("#gender").val()
            },
            success: function (response) {
                showData()
                cancel()
                alert(response.message)
                document.getElementById("nickname").value = Nickname.value
            }
        })
    }
    function cancel() {
        showData()
        title.innerHTML = "會員資料"
        password.disabled = "none"
        Nickname.disabled = "none"
        email.disabled = "none"
        gender.disabled = "none"
        modifyBtn.style.display = ""
        signOutBtn.style.display = ""
        defineBtn.style.display = "none"
        cancelBtn.style.display = "none"
    }
</script>

</html>